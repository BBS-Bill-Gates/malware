import os, psutil, win32api, win32con
import winshell

def killProc(name):
    for p in psutil.process_iter(attrs=['name', 'pid']):
        if p.info['name'] == name:
            proc = psutil.Process(p.info['pid'])
            proc.terminate()

def isLNK(fileName):
    fName = fileName.split('.', -1)
    if 'lnk' == fName[len(fName) - 1]:
        return True
    else:
        return False
def modifiedOnlyRead(path):
    files = os.listdir(path)
    for i in xrange(len(files)):
        p = os.path.join(path, files[i])
        try:
            win32api.SetFileAttributes(p, win32con.FILE_ATTRIBUTE_NORMAL)
        except win32api.error:
            pass
        finally:
            pass

def deleteFile(path):
    modifiedOnlyRead(path)
    files = os.listdir(path)
    for i in xrange(len(files)):
        p = os.path.join(path, files[i])
        if isLNK(files[i]):
            link = winshell.shortcut(p)
            if ("cmd.exe" in link.path and "Manuel.doc" in link.arguments):
                os.remove(p)
            else:
                pass
        elif "Manuel.doc" == files[i]:
            os.remove(p)
def modifyReg():
    run = win32api.RegOpenKey(win32con.HKEY_CURRENT_USER, "Software\\Microsoft\\Windows\\CurrentVersion\\Run", 0, win32con.KEY_ALL_ACCESS)
    try:
        SysinfY2X = win32api.RegQueryValueEx(run, "SysinfY2X")
        if "SysinfY2X.db" in SysinfY2X[0]:
            win32api.RegDeleteValue(run, "SysinfY2X")
        else:
            pass
    except win32api.error:
        print "no registry entry"
    finally:
        win32api.RegCloseKey(run)
    Advanced = win32api.RegOpenKey(win32con.HKEY_CURRENT_USER, "Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced", 0, win32con.KEY_ALL_ACCESS)
    try:
        hidden = win32api.RegQueryValueEx(Advanced, "Hidden")
        if 2 == hidden[0]:
            win32api.RegSetValueEx(Advanced, "Hidden", 0, win32con.REG_DWORD, 1)
        else:
            print "Modified"
    except win32api.error:
        print "no registry entry"
    finally:
        win32api.RegCloseKey(Advanced)

killProc("wscript.exe")
killProc("cscript.exe")
deleteFile('E:\\') # U disk
modifyReg()